# 바이낸스 파이썬 API

### 라이브러리


- FastAPI : 프레임워크
  - > pip install fastapi
- Uvicorn : 웹서버
  - > pip install uvicorn
- HTTPie : 텍스트 웹 클라이언트
  - > pip install httpie
- Requests : 동기식 웹 클라이어트 패키지
  - > pip install requests
- HTTPX : 동기/비동기 웹 클라이언트
  - > pip install httpx
- SQLAlchemy : 데이터베이스 라이브러리
-  > pip install sqlalchemy pymysql
----
- pandas : 데이터 분석 라이브러리
  - > pip install pandas
- numpy
  - > pip install numpy
- binance : python-binance API
  - > pip install python-binance


### 기획

#### 기능
- 코인 목록 조회
  - 코인 차트 조회
    - 전략 대입
      - 백테스팅 결과 조회
- 개인정보 조회
  - 현재 잔고
  - 투자 수익률
    - 일간, 월간 투자 수익률
  - 자동매매 종목 선택
    - 전략 선택
    - 레버리지 지정
      - 손절가 익절가 지정
      - 일 최대 목표 수익률 지정
- 웹 소켓 멀티 쓰레드로 차트 모니터링
  - 종목당 모니터링은 하나만

- 태스크 전체 종료, 선택 종료
## 전략

## ATR
### TR
- 가장 먼저 TR을 구해야한다
    - TR 공식
        - 당일 고가 - 당일 저가
        - 당일 고가 - 전일 종가 의 절대값
        - 당일 저가 - 전일 종가 의 절대값
    - 위 값중 가장 큰 값을 TR이라 한다.
    - 이후 n일간의 평균을 ATR이라 부름
#### 유닛
- 내 총 자산의 n 퍼센트의 리스크만 감수한다.
    - 내 총 자산이 100USDT 리스크 1 % 라면
        - 1USDT / ATR
    - 레버리지를 사용하는 경우 ATR에 * 배수


- MACD + 터틀 매매 기반 전략
  - MACD 선과 시그널 선의 교차 지점을 포지션 진입 신호로 사용
    - 이동 평균선이 단기 중기 장기 모두 우 상향일 경우, 히스토그램이 크지 않은 경우 진입 신호 무시
      - 이후에 다시 매수 신호가 발생할 확률이 높음
    - 캔들이 20일 이동 평균선을 돌파 후 포지션 진입 시그널이 있었다면 포지션 진입
    - 이동 평균선이 우하향, 우상향인 경우 진입 신호가 없더라도 시험 진입(0.5유닛)
        - 숏 포지션인 경우 위에서부터 이동 평균선이 단기, 중기, 장기 나열된 경우
        - 롱 포지션인 경우 위에서부터 이동 평균선이 장기, 중기, 단기로 나열된 경우
    - 캔들이 20일 이동평균선 돌파시 시험진입
    - 시험 진입 후 진입 신호 발생시 1.5유닛 더해서 2유닛 진입
    - 진입 후 1ATR 오를 때마다 최대 4유닛까지 추가진입



## 매매신호 기준
- MACD 골드 크로스
    - 시험 진입
        - 기울기가 양수면 롱
        - 기울기가 음수면 숏
        
- 단중장 골드 크로스
    - 단기 이평선이 중기선을 돌파 했을 때
    - 단기선, 중기선, 장기선이 모두 우상향일 때
        - 추세가 전환되는 시점에만 유효
- 장중단 골드 크로스
    - 단기 이평선이 중기선을 돌파 했을 때
    - 단기선, 중기선, 장기선이 모두 우하향일 때
        - 추세가 전환되는 시점에만 유효

- 혹은 둘 다


## 모델
### 차트 데이터 수집
- 필요한 데이터
  - 코인 이름
  - 리미트 -> 차트 몇개를 수집 할건지
  - 몇일 기준으로 수집 할건지
    - m, h, d


### MACD, RSI, 이평선 계산

### 실시간 모니터링
- 웹소켓
  - 웹소켓 데이터
    - > {'stream': 'btcusdt_perpetual@continuousKline_1m', 
      > 
      > 'data': {'e': 'continuous_kline', 'E': 1745028090662, 'ps': 'BTCUSDT', 'ct': 'PERPETUAL', 
      > 
      > 'k': {'t': 1745028060000, 'T': 1745028119999, 'i': '1m', 'f': 7305301244711, 'L': 7305303930320, 'o': '84502.00', 'c': '84481.00', 'h': '84502.10', 'l': '84481.00', 'v': '17.416', 'n': 337, 'x': False, 'q': '1471603.28810', 'V': '1.822', 'Q': '153933.29390', 'B': '0'}
      > 
      > }
      > 
      > }
  - 필요한 데이터는 k

- 실시간으로 DB 상태 변경
  - 아직 종가가 나오지 않은경우 계속 업데이트
- 이전 데이터를 저장 해야함
  - 어떻게 저장을 할건가?
    - 시작 시간 종료 시간이 같으면 업데이트
    - 모니터링 시작시 300일간의 차트 저장
      - 현재 일자부터 300일 전까지의 차트 요청
      - 코인 차트테이블에 저장
        - 중복인경우 업데이트 또는 무시
  - 데이터 수집 목적
  - 저장할 데이터
  - 매매 신호
      - 종류
      - 거래소
      - 간격
      - 일시
      - 가격
      - 현재 가격과 비교 했을때 수익률
  - 이전 차트
  ````json
    {
      "ETHUSDT": {
        "chart" : {
          "1m": [{
            "t": "",
            "te":"",
            "rsi": "",
            "macd": "",
            "sma7": "",
            "sma20": "",
            "sma60": "",
            "sma120": "",
            "volume": "",
            "close": ""
          }   
            
          ],
          "15m": [],
          "1d": []
        } 
      } 
    }
  ````
   db.test.insert({
  "symbol": "ETHUSDT",
  "interval": "1m",
  "candles": [
    {
      "t": "",
      "te": "",
      "rsi": "",
      "macd": "",
      "sma7": "",
      "sma20": "",
      "sma60": "",
      "sma120": "",
      "volume": "",
      "close": ""
    }
  ]
})


````
[
  [
    1499040000000,      // Open time
    "0.01634790",       // Open
    "0.80000000",       // High
    "0.01575800",       // Low
    "0.01577100",       // Close
    "148976.11427815",  // Volume
    1499644799999,      // Close time
    "2434.19055334",    // Quote asset volume
    308,                // Number of trades
    "1756.87402397",    // Taker buy base asset volume
    "28.46694368",      // Taker buy quote asset volume
    "17928899.62484339" // Ignore.
  ]
]


````